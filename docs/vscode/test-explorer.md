/*
Title: Test Explorer
Description: Visual PHPUnit test explorer
*/

# Test Explorer

Test explorer view enables visual execution and debugging of PHPUnit tests. The tests are executed by the PHPUnit and the results are displayed in the **Test View**, shown in the next figure. The PHPUnit output is shown in the **PHP (PHPUnit)** output tab.

![Test Explorer](imgs/test-view.png)

## Configuration

It is necessary to configure the system, before the tests can be executed. The process requires PHP, the PHPUnit phar file and a configuration file. 

The test results are generated by running the **php -d display_errors=on PHPUnit.phar --teamcity** in the workspace root directory. This command relies on the *phpunit.xml* to be present in the root. The configuration file must identify all the desired tests and provide all the setting to PHPUnit.

### PHP

Tests require working PHP runtime, which is either:

1. The command specified by the *php.executablePath* value in user setting.
2. *php* on the command line if the setting is not present.

### PHPUnit

The PHPUnit phar file is necessary to execute the tests and PHP Tools try to locate PHPUnit phar in:

1. The vendor directory usually created by composer. 
2. Built-in PHPUnit phar (version 6.5.12.) distributed with PHP Tools, in case the phar is not found in vendor.

### Configuration File

The tests rely on phpunit.xml configuration file ([PHPUnit configuration](https://phpunit.de/manual/6.5/en/appendixes.configuration.html)), which must be placed in the root of the workspace.

PHP Tools can generate basic configuration file, if they locate any tests and the configuration file is missing. 
If the configuration file is missing and PHP Tools locate any files named \*test.php, they offer to create a basic configuration via a pop-up message.

![Configuration pop-up](imgs/test-pop-up.png)

### Tests

The name, location, extension and settings of the tests are defined in the phpunit.xml configuration file. 
The tests should be located in a sub-directory, not directly in the workspace root, because PHPUnit does not recognise them there.

## Test Explorer View

Test explorer view provides tools for manual and automatic test execution with visual representaion of the results.
The view is only visible if there are some tests or the phpunit.xml configuration file in the workspace.

![Test Explorer](imgs/test-explorer.gif)

## Test Results

Test results are displayed in the test explorer view as small icons next to each test with the following meaning:

* ![Test success](imgs/test-success.png) - Test was executed without errors
* ![Test failure](imgs/test-failure.png) - Test was executed with errors, error message is in the output tab
* ![Test skipped](imgs/test-skipped.png) - Test was executed and skipped ([PHPUnit configuration](https://phpunit.de/manual/6.5/en/incomplete-and-skipped-tests.html))
* ![Test running](imgs/test-running.png) - Test is currently running, shown usually during debugging

The actual result of the PHPUnit execution is displayed in the **PHP (PHPUnit)** output tab, while each test has its own output available by clicking on the test int the test explorer view.

![Test Output](imgs/test-output.png)

## Debugging Tests

Tests can be debugged with Xdebug usin the bug-like icon in the test explorer view. Tests can be debugged one at a time, it is not possible to debug all tests at once. The debugging process is the same as [standard debugging](Debug).

![Test Explorer](imgs/test-debug.gif)

## Continuous Testing

Tests can be executed continuously by enabling autorun in the test explorer view. Once enabled, tests will be executed every time a tested file is saved after modification.

![Test Autorun](imgs/test-autorun.png)
